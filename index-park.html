<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>랜덤 포켓몬</title>
  <style>
    @font-face {
    font-family: 'NeoDunggeunmoPro-Regular';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/NeoDunggeunmoPro-Regular.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}
    * {
      font-family: 'NeoDunggeunmoPro-Regular';
    }

  </style>
</head>
<body>

  <div id="root"></div>
  <script>


    
    const root = document.getElementById('root');
    // root 식별
    root.style.cssText="display : flex; justify-content : center; align-items : center; flex-direction : column;"


    
    for (let i = 0; i < 3; i++) {
      const creatDiv = document.createElement('div');
      creatDiv.setAttribute("class", "items");
      root.appendChild(creatDiv);
    }

    const createBtn = document.createElement('button');
    createBtn.setAttribute("class", "random_button");
    createBtn.textContent="뽑기";
    root.appendChild(createBtn);



    const ohDoctor = document.createElement('img');
    ohDoctor.setAttribute("src", "https://i.namu.wiki/i/z9PdYANrjSX71l0tk_Og7o_Qvhfkd9durUP0dSZqN19RePCZmBMwBCp_kHza1QZ9WowH404vPtau6RbbPFYNGA.png");
    root.children[0].appendChild(ohDoctor);

    const xhr = new XMLHttpRequest();
    // 문서가 서버에 데이터 요청 시작

    let random = Math.floor(Math.random() * 1010);
    // 현존하는 포켓몬 수(1010) 범위 내에서 무작위 숫자 생성하도록 변수 선언

    let _URL = 'https://pokeapi.co/api/v2/pokemon/'+random;
    //링크를 불러올 때마다 뒤에 붙여질 도감 번호를 랜덤으로 설정

    xhr.open('GET', _URL);
    // 접속할 URL을 어떻게 열지 정하고 (GET 혹은 POST) 입력하기 위해 미리 선언한 변수 (_URL)입력
    // xhr.responseType='json' <- JSON.parse 말고 다른 방식

    xhr.send();
    // API 서버에 요청 전송
    
    
    xhr.addEventListener('load', function() { // xhr 변수가 'load' 됐을 때, 함수 시작
      const _PokeData = JSON.parse(xhr.response);

      const _PokePhoto = _PokeData.sprites;
      // 변수 _PokeDate의 sptites(포켓몬 초상화) 위치를 찾은 뒤 식별해줌 

      const h2 = document.createElement('img');
      h2.setAttribute("src", _PokePhoto.front_default);
      root.children[1].appendChild(h2);
      h2.style.display="none";
      // 포켓몬 초상화 출력.


      // 한글 포켓몬 이름 가져오기 위해 한번 더 불러온다.
      const xhr2 = new XMLHttpRequest();
      xhr2.open('GET', _PokeData.species.url);
      // 이번엔 맨 처음 선언한 _PokeData의 .species.url의 정보를 가져오려고 함

      xhr2.send();
      //서버에 요청

      xhr2.addEventListener('load', function () {
      const _PokeKoreaData = JSON.parse(xhr2.response);
      // 마찬가지로 자바스크립트로 활용할 수 있도록 JSON.parse 선언


      const _PokeKoreaName = _PokeKoreaData.names[2];
      // 한국어 이름 식별

      const h1 = document.createElement('h1');
      h1.textContent = _PokeKoreaName.name;
      root.children[2].appendChild(h1);
      h1.style.display="none";
      // 포켓몬 한글 이름 출력..

      createBtn.addEventListener("click", function() {
      createBtn.textContent="다시 뽑기";
      h1.style.display="inline-block";
      h2.style.display="inline-block";

    })
  })
});

createBtn.addEventListener("click", function() {
  let _URL = 'https://pokeapi.co/api/v2/pokemon/'+random;
  if (createBtn.textContent === "다시 뽑기") {
    xhr.open('GET', _URL);
    xhr.send();
    
    xhr.addEventListener('load', function() { // xhr 변수가 'load' 됐을 때, 함수 시작
    const _PokeData = JSON.parse(xhr.response);

    const _PokePhoto = _PokeData.sprites;

    const h2 = document.createElement('img');
    h2.setAttribute("src", _PokePhoto.front_default);
    root.children[1].appendChild(h2);


    const xhr2 = new XMLHttpRequest();
    xhr2.open('GET', _PokeData.species.url);

    xhr2.send();

    xhr2.addEventListener('load', function () {
    const _PokeKoreaData = JSON.parse(xhr2.response);

    const _PokeKoreaName = _PokeKoreaData.names[2];
    const h1 = document.createElement('h1');
    h1.textContent = _PokeKoreaName.name;
    root.children[2].appendChild(h1);
    // 포켓몬 한글 이름 출력..
    createBtn.addEventListener("click", function() {
    createBtn.textContent="다시 뽑기";
    h1.style.display="inline-block";
    h2.style.display="inline-block";
    })
      })
      })
    }
});



  </script>
</body>
</html>